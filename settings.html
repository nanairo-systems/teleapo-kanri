<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®š - ãƒ†ãƒ¬ã‚¢ãƒé¡§å®¢ç®¡ç†</title>
  <style>
    :root {
      --primary: #2563eb; --primary-hover: #1d4ed8; --success: #16a34a;
      --warning: #f59e0b; --danger: #dc2626;
      --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb;
      --gray-300: #d1d5db; --gray-400: #9ca3af; --gray-500: #6b7280;
      --gray-600: #4b5563; --gray-700: #374151; --gray-800: #1f2937;
      --gray-900: #111827; --radius: 8px;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.06);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background: var(--gray-50); color: var(--gray-800); line-height: 1.6; }

    .navbar { background: #fff; border-bottom: 1px solid var(--gray-200); padding: 0 24px; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow); }
    .navbar-inner { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; height: 56px; }
    .navbar-brand { font-size: 18px; font-weight: 700; color: var(--primary); text-decoration: none; display: flex; align-items: center; gap: 8px; }
    .navbar-brand .icon { font-size: 22px; }
    .hamburger { display: none; background: none; border: none; cursor: pointer; flex-direction: column; gap: 5px; padding: 4px; }
    .hamburger span { display: block; width: 22px; height: 2px; background: var(--gray-600); border-radius: 2px; }
    .navbar-nav { display: flex; gap: 4px; list-style: none; }
    .navbar-nav a { display: flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: var(--radius); text-decoration: none; color: var(--gray-600); font-size: 14px; font-weight: 500; transition: background 0.15s, color 0.15s; }
    .navbar-nav a:hover { background: var(--gray-100); color: var(--gray-800); }
    .navbar-nav a.active { background: #eff6ff; color: var(--primary); }

    .container { max-width: 720px; margin: 0 auto; padding: 24px; }
    .page-header { margin-bottom: 24px; }
    .page-header h1 { font-size: 22px; font-weight: 700; color: var(--gray-900); }
    .page-header p { font-size: 14px; color: var(--gray-500); margin-top: 4px; }

    .card { background: #fff; border: 1px solid var(--gray-200); border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 20px; }
    .card-header { padding: 16px 20px; border-bottom: 1px solid var(--gray-200); }
    .card-header h2 { font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .card-header p { font-size: 13px; color: var(--gray-500); margin-top: 4px; }
    .card-body { padding: 20px; }

    .form-group { margin-bottom: 18px; }
    .form-group:last-child { margin-bottom: 0; }
    .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--gray-700); margin-bottom: 6px; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 10px 14px; border: 1px solid var(--gray-300); border-radius: var(--radius);
      font-size: 14px; font-family: inherit; outline: none; transition: border-color 0.15s;
    }
    .form-group input:focus, .form-group select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
    .form-hint { font-size: 12px; color: var(--gray-400); margin-top: 4px; line-height: 1.5; }

    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 18px; border: none; border-radius: var(--radius); font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.15s, transform 0.1s; text-decoration: none; white-space: nowrap; }
    .btn:active { transform: scale(0.97); }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-success { background: var(--success); color: #fff; }
    .btn-success:hover { background: #15803d; }
    .btn-outline { background: #fff; color: var(--gray-700); border: 1px solid var(--gray-300); }
    .btn-outline:hover { background: var(--gray-100); }
    .btn-danger-outline { background: #fff; color: var(--danger); border: 1px solid #fecaca; }
    .btn-danger-outline:hover { background: #fef2f2; }
    .btn-sm { padding: 5px 12px; font-size: 13px; }
    .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }

    .status-indicator { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: var(--radius); font-size: 13px; font-weight: 600; }
    .status-ok { background: #dcfce7; color: #166534; }
    .status-ng { background: #fee2e2; color: #991b1b; }
    .status-unknown { background: var(--gray-100); color: var(--gray-500); }

    .btn-logout { background: none; border: 1px solid var(--gray-300); border-radius: var(--radius); padding: 5px 12px; font-size: 13px; cursor: pointer; color: var(--gray-600); font-weight: 500; transition: all 0.15s; }
    .btn-logout:hover { background: #fef2f2; color: var(--danger); border-color: #fecaca; }
    .nav-user { font-size: 13px; color: var(--gray-500); padding: 0 4px; display: flex; align-items: center; white-space: nowrap; }

    .list-table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .list-table th { padding: 8px 12px; text-align: left; font-weight: 600; color: var(--gray-600); font-size: 12px; border-bottom: 1px solid var(--gray-200); background: var(--gray-50); }
    .list-table td { padding: 8px 12px; border-bottom: 1px solid var(--gray-100); }
    .list-table tr:last-child td { border-bottom: none; }
    .list-table .actions { white-space: nowrap; }
    .list-table .actions button { margin-left: 4px; }
    .biz-chips { display: flex; flex-wrap: wrap; gap: 4px; }
    .biz-chip { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 11px; font-weight: 600; background: #eff6ff; color: var(--primary); }
    .empty-row { text-align: center; padding: 20px; color: var(--gray-400); }

    .add-inline { display: flex; gap: 8px; align-items: flex-end; flex-wrap: wrap; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--gray-100); }
    .add-inline .form-group { margin-bottom: 0; flex: 1; min-width: 140px; }
    .add-inline .form-group label { margin-bottom: 4px; }
    .add-inline .form-group input, .add-inline .form-group select { padding: 8px 10px; font-size: 13px; }

    .tag-list { display: flex; flex-direction: column; gap: 8px; }
    .tag-row { display: flex; align-items: center; gap: 8px; }
    .tag-editable {
      display: flex; align-items: center; gap: 6px; padding: 6px 14px;
      border-radius: 999px; font-size: 13px; font-weight: 600;
      background: #eff6ff; color: var(--primary); border: 1px solid #bfdbfe;
    }
    .tag-editable input {
      border: none; background: transparent; font-size: 13px; font-weight: 600;
      color: var(--primary); outline: none; width: 120px; padding: 0;
      font-family: inherit;
    }
    .tag-remove { background: none; border: none; cursor: pointer; font-size: 14px; color: var(--gray-400); line-height: 1; padding: 0 2px; }
    .tag-remove:hover { color: var(--danger); }
    .tag-label { font-size: 11px; color: var(--gray-400); white-space: nowrap; min-width: 50px; }
    .tag-preview { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-100); }
    .tag-preview-title { font-size: 12px; font-weight: 600; color: var(--gray-500); margin-bottom: 4px; width: 100%; }
    .tag-chip { padding: 5px 14px; border-radius: 999px; font-size: 13px; font-weight: 600; border: 2px solid #bfdbfe; background: #eff6ff; color: var(--primary); }

    .setup-steps { counter-reset: step; padding: 0; list-style: none; }
    .setup-steps li { counter-increment: step; padding: 12px 0 12px 40px; position: relative; border-bottom: 1px solid var(--gray-100); font-size: 14px; color: var(--gray-700); line-height: 1.7; }
    .setup-steps li:last-child { border-bottom: none; }
    .setup-steps li::before { content: counter(step); position: absolute; left: 0; top: 12px; width: 28px; height: 28px; border-radius: 50%; background: var(--primary); color: #fff; font-size: 13px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
    .setup-steps code { background: var(--gray-100); padding: 2px 6px; border-radius: 4px; font-size: 13px; color: var(--gray-700); }

    .toast-container { position: fixed; top: 70px; right: 24px; z-index: 400; display: flex; flex-direction: column; gap: 8px; }
    .toast { background: #fff; border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 12px 16px; box-shadow: var(--shadow-md); font-size: 14px; display: flex; align-items: center; gap: 8px; animation: slideIn 0.3s ease; max-width: 360px; }
    .toast.success { border-left: 4px solid var(--success); }
    .toast.error { border-left: 4px solid var(--danger); }
    @keyframes slideIn { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: translateX(0); } }
    .loading-overlay { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.7); z-index: 200; align-items: center; justify-content: center; }
    .loading-overlay.show { display: flex; }
    .spinner { width: 40px; height: 40px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 768px) {
      .navbar { padding: 0 12px; }
      .navbar-inner { position: relative; }
      .hamburger { display: flex; }
      .navbar-nav { display: none; position: absolute; top: 56px; left: -12px; right: -12px; background: #fff; border-bottom: 1px solid var(--gray-200); flex-direction: column; padding: 8px; box-shadow: var(--shadow-md); z-index: 101; }
      .navbar-nav.open { display: flex; }
      .navbar-nav a { padding: 12px 16px; font-size: 15px; }
      .container { padding: 16px; }
      .add-inline { flex-direction: column; }
      .list-table th, .list-table td { padding: 6px 8px; font-size: 13px; }
    }
  </style>
</head>
<body>

<nav class="navbar">
  <div class="navbar-inner">
    <a href="index.html" class="navbar-brand"><span class="icon">ğŸ“</span>ãƒ†ãƒ¬ã‚¢ãƒé¡§å®¢ç®¡ç†</a>
    <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
    <ul class="navbar-nav" id="navMenu">
      <li><a href="index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
      <li><a href="import.html">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</a></li>
      <li><a href="settings.html" class="active">âš™ï¸ è¨­å®š</a></li>
      <li class="nav-user" id="navUserInfo"></li>
      <li><button class="btn-logout" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button></li>
    </ul>
  </div>
</nav>

<div class="loading-overlay" id="loading"><div class="spinner"></div></div>
<div class="toast-container" id="toastContainer"></div>

<div class="container">
  <div class="page-header">
    <h1>âš™ï¸ è¨­å®š</h1>
    <p>ã‚·ã‚¹ãƒ†ãƒ ã®æ¥ç¶šè¨­å®šã‚„å„ç¨®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã—ã¾ã™</p>
  </div>

  <!-- GAS API æ¥ç¶šè¨­å®š -->
  <div class="card">
    <div class="card-header">
      <h2>ğŸ”— GAS API æ¥ç¶šè¨­å®š</h2>
      <p>Google Apps Script ã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¾ã™</p>
    </div>
    <div class="card-body">
      <div class="form-group">
        <label>GAS Webã‚¢ãƒ—ãƒªURL</label>
        <input type="url" id="gasUrl" placeholder="https://script.google.com/macros/s/xxxxx/exec">
        <div class="form-hint">Google Apps Script ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å–å¾—ã—ãŸURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="saveGasUrl()">ğŸ’¾ URLã‚’ä¿å­˜</button>
        <button class="btn btn-outline" onclick="testConnection()">ğŸ” æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
      </div>
      <div style="margin-top: 12px;">
        <span class="status-indicator status-unknown" id="connectionStatus">â³ æœªãƒ†ã‚¹ãƒˆ</span>
      </div>
    </div>
  </div>

  <!-- å¯¾å¿œè€…ãƒã‚¹ã‚¿ãƒ¼ -->
  <div class="card">
    <div class="card-header">
      <h2>ğŸ‘¥ å¯¾å¿œè€…ãƒã‚¹ã‚¿ãƒ¼</h2>
      <p>æ¶é›»ç™»éŒ²æ™‚ã«ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§é¸æŠã§ãã‚‹å¯¾å¿œè€…ã‚’ç®¡ç†ã—ã¾ã™</p>
    </div>
    <div class="card-body">
      <table class="list-table" id="operatorTable">
        <thead><tr><th>å¯¾å¿œè€…å</th><th>æ‹…å½“æ¥­å‹™</th><th style="width:100px;">æ“ä½œ</th></tr></thead>
        <tbody id="operatorBody"></tbody>
      </table>
      <div class="add-inline" id="operatorAdd">
        <div class="form-group">
          <label>å¯¾å¿œè€…å</label>
          <input type="text" id="newOpName" placeholder="ä¾‹ï¼šå±±ç”°å¤ªéƒ">
        </div>
        <div class="form-group" style="min-width:200px;">
          <label>æ‹…å½“æ¥­å‹™</label>
          <select id="newOpBiz" multiple style="height:auto;min-height:40px;padding:6px 8px;"></select>
        </div>
        <button class="btn btn-primary btn-sm" onclick="addOperator()">ï¼‹ è¿½åŠ </button>
      </div>
      <div class="form-hint" style="margin-top: 8px;">æ‹…å½“æ¥­å‹™ã¯ Ctrl/Cmd+ã‚¯ãƒªãƒƒã‚¯ ã§è¤‡æ•°é¸æŠã§ãã¾ã™ã€‚æœªé¸æŠãªã‚‰å…¨æ¥­å‹™ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
    </div>
  </div>

  <!-- é¡§å®¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ã‚°ï¼ˆæ¥­å‹™åˆ¥ï¼‰ -->
  <div class="card">
    <div class="card-header">
      <h2>ğŸ·ï¸ é¡§å®¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ã‚°</h2>
      <p>æ¥­å‹™ã”ã¨ã«é¡§å®¢ã«ä»˜ä¸ã™ã‚‹ã‚¿ã‚°ã‚’ç®¡ç†ã—ã¾ã™ï¼ˆé¡§å®¢è©³ç´°ç”»é¢ã§è¤‡æ•°é¸æŠå¯èƒ½ï¼‰</p>
    </div>
    <div class="card-body">
      <div class="form-group">
        <label>æ¥­å‹™ã‚’é¸æŠ</label>
        <select id="tagBizSelect" onchange="onTagBizChange()"></select>
      </div>

      <div id="tagEditor" style="display:none;">
        <div class="tag-list" id="tagList"></div>
        <div class="tag-preview" id="tagPreview"></div>
      </div>
      <div id="tagPlaceholder" style="text-align:center;padding:20px;color:var(--gray-400);">
        æ¥­å‹™ã‚’é¸æŠã—ã¦ã‚¿ã‚°ã‚’ç·¨é›†ã—ã¦ãã ã•ã„
      </div>
    </div>
  </div>

  <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ -->
  <div class="card">
    <div class="card-header">
      <h2>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
      <p>ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç®¡ç†ã—ã¾ã™ã€‚ç®¡ç†è€…ã¯ã™ã¹ã¦ã®è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã™</p>
    </div>
    <div class="card-body">
      <table class="list-table" id="userTable">
        <thead><tr><th>ãƒ­ã‚°ã‚¤ãƒ³ID</th><th>åå‰</th><th>æ¨©é™</th><th style="width:120px;">æ“ä½œ</th></tr></thead>
        <tbody id="userBody"></tbody>
      </table>
      <div class="add-inline" id="userAdd">
        <div class="form-group">
          <label>ãƒ­ã‚°ã‚¤ãƒ³ID</label>
          <input type="text" id="newUserId" placeholder="ä¾‹ï¼šyamada" autocomplete="off">
        </div>
        <div class="form-group">
          <label>åå‰</label>
          <input type="text" id="newUserName" placeholder="ä¾‹ï¼šå±±ç”°å¤ªéƒ" autocomplete="off">
        </div>
        <div class="form-group" style="min-width:130px;">
          <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="password" id="newUserPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" autocomplete="new-password">
        </div>
        <div class="form-group" style="min-width:110px;">
          <label>æ¨©é™</label>
          <select id="newUserRole">
            <option value="staff">ğŸ‘¤ ã‚¹ã‚¿ãƒƒãƒ•</option>
            <option value="admin">ğŸ”‘ ç®¡ç†è€…</option>
          </select>
        </div>
        <button class="btn btn-primary btn-sm" onclick="addUser()">ï¼‹ è¿½åŠ </button>
      </div>
      <div class="form-hint" style="margin-top:8px;">
        â€» ç®¡ç†è€…ã¯è¨­å®šç”»é¢ã®å…¨æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ã‚¹ã‚¿ãƒƒãƒ•ã¯é¡§å®¢ç®¡ç†ãƒ»æ¶é›»ã®ã¿åˆ©ç”¨ã§ãã¾ã™ã€‚
      </div>
    </div>
  </div>

  <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ -->
  <div class="card">
    <div class="card-header"><h2>ğŸ“– ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰</h2><p>åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æ‰‹é †</p></div>
    <div class="card-body">
      <ol class="setup-steps">
        <li><strong>Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ</strong><br>æ–°ã—ã„Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã‚·ãƒ¼ãƒˆ <code>é¡§å®¢ãƒã‚¹ã‚¿</code> ã¨ <code>æ¶é›»å±¥æ­´</code> ã¯GASãŒè‡ªå‹•ä½œæˆã—ã¾ã™</li>
        <li><strong>GAS ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨­å®š</strong><br>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€â†’ã€ŒApps Scriptã€ã‚’é–‹ãã€<code>gas/code.gs</code> ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™</li>
        <li><strong>Webã‚¢ãƒ—ãƒªã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤</strong><br>Apps Script ã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ ç¨®é¡ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’é¸æŠã€‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã€Œå…¨å“¡ã€ã«ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™</li>
        <li><strong>URLã‚’è¨­å®š</strong><br>ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹URLã‚’ã‚³ãƒ”ãƒ¼ã—ã€ä¸Šã®ã€ŒGAS Webã‚¢ãƒ—ãƒªURLã€æ¬„ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¾ã™</li>
        <li><strong>æ¥ç¶šãƒ†ã‚¹ãƒˆ</strong><br>ã€Œæ¥ç¶šãƒ†ã‚¹ãƒˆã€ãƒœã‚¿ãƒ³ã§æ­£ã—ãæ¥ç¶šã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚ã€Œæ¥ç¶šOKã€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°å®Œäº†ã§ã™</li>
      </ol>
    </div>
  </div>

  <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
  <div class="card">
    <div class="card-header"><h2>ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2></div>
    <div class="card-body">
      <div class="btn-group">
        <button class="btn btn-outline" onclick="exportData()">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆCSVï¼‰</button>
        <button class="btn btn-danger-outline" onclick="clearLocalData()">ğŸ—‘ï¸ ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div class="form-hint" style="margin-top: 8px;">â€» ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã®ãƒªã‚»ãƒƒãƒˆã¯GAS URLãƒ»å¯¾å¿œè€…ãƒ»ã‚¿ã‚°ãƒ»æ¥­å‹™ä¸€è¦§ãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®ã¿å‰Šé™¤ã—ã¾ã™ã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚</div>
    </div>
  </div>
</div>

<script>
  // â”€â”€ èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ â”€â”€
  (function() {
    const a = JSON.parse(localStorage.getItem('authSession') || 'null');
    if (!a || Date.now() > a.expiry) { localStorage.removeItem('authSession'); location.replace('login.html'); return; }
    if (a.role !== 'admin') { alert('ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™'); location.replace('index.html'); }
  })();

  function logout() {
    if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) { localStorage.removeItem('authSession'); location.href = 'login.html'; }
  }

  const DEFAULT_TAGS = ['è¦‹è¾¼ã¿é«˜', 'è¦‹è¾¼ã¿ä½', 'ã‚¢ãƒæ¸ˆã¿', 'æ–­ã‚Š', 'è¦ãƒ•ã‚©ãƒ­ãƒ¼'];
  const MAX_TAGS = 10;

  let operators = [];
  let customTags = [];
  let users = [];

  // â”€â”€ è¨­å®šåŒæœŸ â”€â”€
  async function loadAppSettings() {
    const apiUrl = localStorage.getItem('gasApiUrl');
    if (apiUrl) {
      try {
        const res = await fetch(`${apiUrl}?action=getSettings`);
        const data = await res.json();
        if (data.settings) {
          if (data.settings.businesses) localStorage.setItem('businesses', JSON.stringify(data.settings.businesses));
          if (data.settings.operators) localStorage.setItem('operators', JSON.stringify(data.settings.operators));
          if (data.settings.customerTagsByBusiness) localStorage.setItem('customerTagsByBusiness', JSON.stringify(data.settings.customerTagsByBusiness));
        }
      } catch(e) {}
    }
  }
  async function saveAppSetting(key, value) {
    localStorage.setItem(key, JSON.stringify(value));
    const apiUrl = localStorage.getItem('gasApiUrl');
    if (apiUrl) {
      try { await fetch(apiUrl, { method:'POST', headers:{'Content-Type':'text/plain'}, body: JSON.stringify({action:'saveSettings',key,value}) }); } catch(e) {}
    }
  }

  document.addEventListener('DOMContentLoaded', async () => {
    document.getElementById('gasUrl').value = localStorage.getItem('gasApiUrl') || '';
    const auth = JSON.parse(localStorage.getItem('authSession') || 'null');
    if (auth) { const el = document.getElementById('navUserInfo'); if (el) el.textContent = `ğŸ‘¤ ${auth.name}`; }
    await loadAppSettings();
    loadOperators();
    loadUsers();
    loadTags();
    populateBizSelect();
    document.getElementById('hamburger').addEventListener('click', () => {
      document.getElementById('navMenu').classList.toggle('open');
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // GAS URL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function saveGasUrl() {
    const url = document.getElementById('gasUrl').value.trim();
    if (!url) { localStorage.removeItem('gasApiUrl'); showToast('URLã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success'); setStatus('unknown', 'â³ æœªãƒ†ã‚¹ãƒˆ'); return; }
    if (!url.startsWith('https://script.google.com/')) { showToast('æ­£ã—ã„GAS URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
    localStorage.setItem('gasApiUrl', url);
    showToast('GAS URLã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
  }

  async function testConnection() {
    const url = document.getElementById('gasUrl').value.trim();
    if (!url) { showToast('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
    setStatus('unknown', 'â³ ãƒ†ã‚¹ãƒˆä¸­...');
    showLoading(true);
    try {
      const res = await fetch(`${url}?action=ping`, { signal: AbortSignal.timeout(15000) });
      const data = await res.json();
      if (data.status === 'ok' || data.success) { setStatus('ok', 'âœ… æ¥ç¶šOK'); showToast('æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼', 'success'); }
      else throw new Error(data.error || 'Unknown');
    } catch (e) { setStatus('ng', 'âŒ æ¥ç¶šå¤±æ•—'); showToast('æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message, 'error'); }
    finally { showLoading(false); }
  }

  function setStatus(type, text) { const el = document.getElementById('connectionStatus'); el.className = `status-indicator status-${type}`; el.textContent = text; }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // å¯¾å¿œè€…ãƒã‚¹ã‚¿ãƒ¼
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function loadOperators() {
    operators = JSON.parse(localStorage.getItem('operators') || '[]');
    renderOperators();
  }

  function saveOperators() { saveAppSetting('operators', operators); }

  function populateBizSelect() {
    const businesses = JSON.parse(localStorage.getItem('businesses') || '[]');
    const sel = document.getElementById('newOpBiz');
    sel.innerHTML = businesses.map(b => `<option value="${b.id}">${b.icon} ${b.name}</option>`).join('');
  }

  function renderOperators() {
    const body = document.getElementById('operatorBody');
    const businesses = JSON.parse(localStorage.getItem('businesses') || '[]');
    if (operators.length === 0) {
      body.innerHTML = '<tr><td colspan="3" class="empty-row">å¯¾å¿œè€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</td></tr>';
      return;
    }
    body.innerHTML = operators.map((op, i) => {
      const bizNames = (op.businessIds || []).map(bid => {
        const b = businesses.find(x => x.id === bid);
        return b ? `<span class="biz-chip">${b.icon} ${b.name}</span>` : '';
      }).filter(Boolean).join('');
      return `<tr>
        <td><strong>${esc(op.name)}</strong></td>
        <td><div class="biz-chips">${bizNames || '<span style="color:var(--gray-400);font-size:12px;">å…¨æ¥­å‹™</span>'}</div></td>
        <td class="actions">
          <button class="btn btn-outline btn-sm" onclick="editOperator(${i})">âœï¸</button>
          <button class="btn btn-danger-outline btn-sm" onclick="deleteOperator(${i})">ğŸ—‘ï¸</button>
        </td>
      </tr>`;
    }).join('');
  }

  function addOperator() {
    const name = document.getElementById('newOpName').value.trim();
    if (!name) { showToast('å¯¾å¿œè€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
    const sel = document.getElementById('newOpBiz');
    const bizIds = Array.from(sel.selectedOptions).map(o => o.value);
    operators.push({ id: Date.now().toString(36), name, businessIds: bizIds });
    saveOperators(); renderOperators();
    document.getElementById('newOpName').value = '';
    sel.selectedIndex = -1;
    showToast(`${name} ã‚’è¿½åŠ ã—ã¾ã—ãŸ`, 'success');
  }

  function editOperator(idx) {
    const op = operators[idx];
    const newName = prompt('å¯¾å¿œè€…åã‚’ç·¨é›†', op.name);
    if (newName === null) return;
    if (!newName.trim()) { showToast('åå‰ã¯ç©ºã«ã§ãã¾ã›ã‚“', 'error'); return; }
    op.name = newName.trim();
    saveOperators(); renderOperators();
    showToast('å¯¾å¿œè€…ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
  }

  function deleteOperator(idx) {
    if (!confirm(`ã€Œ${operators[idx].name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
    operators.splice(idx, 1);
    saveOperators(); renderOperators();
    showToast('å¯¾å¿œè€…ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // é¡§å®¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ã‚°ï¼ˆæ¥­å‹™åˆ¥ï¼‰
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  let selectedTagBizId = '';

  function loadTags() { populateTagBizSelect(); }

  function populateTagBizSelect() {
    const businesses = JSON.parse(localStorage.getItem('businesses') || '[]');
    const sel = document.getElementById('tagBizSelect');
    sel.innerHTML = '<option value="">-- æ¥­å‹™ã‚’é¸æŠ --</option>' +
      businesses.map(b => `<option value="${b.id}">${b.icon} ${b.name}</option>`).join('');
  }

  function onTagBizChange() {
    selectedTagBizId = document.getElementById('tagBizSelect').value;
    if (selectedTagBizId) {
      customTags = getTagsForBusiness(selectedTagBizId);
      document.getElementById('tagEditor').style.display = '';
      document.getElementById('tagPlaceholder').style.display = 'none';
      renderTags();
    } else {
      document.getElementById('tagEditor').style.display = 'none';
      document.getElementById('tagPlaceholder').style.display = '';
    }
  }

  function getTagsForBusiness(bizId) {
    const allTags = JSON.parse(localStorage.getItem('customerTagsByBusiness') || '{}');
    return allTags[bizId] || [...DEFAULT_TAGS];
  }

  function saveTags() {
    if (!selectedTagBizId) return;
    const allTags = JSON.parse(localStorage.getItem('customerTagsByBusiness') || '{}');
    allTags[selectedTagBizId] = customTags;
    saveAppSetting('customerTagsByBusiness', allTags);
    renderTagPreview();
  }

  function renderTags() {
    const list = document.getElementById('tagList');
    list.innerHTML = customTags.map((tag, i) => `
      <div class="tag-row">
        <span class="tag-label">ã‚¿ã‚°${i + 1}</span>
        <div class="tag-editable">
          <input type="text" value="${esc(tag)}" onchange="updateTag(${i}, this.value)" onblur="updateTag(${i}, this.value)">
          <button class="tag-remove" onclick="removeTag(${i})">&times;</button>
        </div>
      </div>
    `).join('') +
    (customTags.length < MAX_TAGS ? `
      <div class="tag-row">
        <span class="tag-label"></span>
        <button class="btn btn-outline btn-sm" onclick="addTag()">ï¼‹ ã‚¿ã‚°ã‚’è¿½åŠ ï¼ˆæ®‹ã‚Š${MAX_TAGS - customTags.length}ï¼‰</button>
      </div>
    ` : '');
    renderTagPreview();
  }

  function updateTag(idx, value) {
    value = value.trim();
    if (!value) { showToast('ã‚¿ã‚°åã¯ç©ºã«ã§ãã¾ã›ã‚“', 'error'); renderTags(); return; }
    customTags[idx] = value;
    saveTags();
  }

  function addTag() {
    if (customTags.length >= MAX_TAGS) { showToast(`ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ã¯${MAX_TAGS}ã¤ã¾ã§ã§ã™`, 'error'); return; }
    customTags.push('æ–°ã—ã„ã‚¿ã‚°');
    saveTags(); renderTags();
  }

  function removeTag(idx) {
    if (!confirm(`ã€Œ${customTags[idx]}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
    customTags.splice(idx, 1);
    saveTags(); renderTags();
    showToast('ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
  }

  function renderTagPreview() {
    const businesses = JSON.parse(localStorage.getItem('businesses') || '[]');
    const biz = businesses.find(b => b.id === selectedTagBizId);
    const bizLabel = biz ? `${biz.icon} ${biz.name}` : '';
    document.getElementById('tagPreview').innerHTML = `
      <div class="tag-preview-title">é¡§å®¢è©³ç´°ç”»é¢ã§ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼${bizLabel ? `ï¼ˆ${bizLabel}ï¼‰` : ''}:</div>
      ${customTags.map(t => `<span class="tag-chip">${esc(t)}</span>`).join('')}
    `;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password + '_teleapo_v1');
    const hash = await crypto.subtle.digest('SHA-256', data);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  function loadUsers() {
    users = JSON.parse(localStorage.getItem('users') || '[]');
    renderUsers();
  }

  function saveUsers() { saveAppSetting('users', users); }

  function renderUsers() {
    const body = document.getElementById('userBody');
    const auth = JSON.parse(localStorage.getItem('authSession') || 'null');
    if (users.length === 0) {
      body.innerHTML = '<tr><td colspan="4" class="empty-row">ãƒ¦ãƒ¼ã‚¶ãƒ¼æœªç™»éŒ²ï¼ˆåˆæœŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼šadmin / admin123ï¼‰</td></tr>';
      return;
    }
    body.innerHTML = users.map((u, i) => `<tr>
      <td><code style="background:var(--gray-100);padding:2px 6px;border-radius:4px;">${esc(u.loginId)}</code></td>
      <td>${esc(u.name)}</td>
      <td>${u.role === 'admin' ? 'ğŸ”‘ ç®¡ç†è€…' : 'ğŸ‘¤ ã‚¹ã‚¿ãƒƒãƒ•'}</td>
      <td class="actions">
        <button class="btn btn-outline btn-sm" onclick="changePassword(${i})" title="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´">ğŸ”‘</button>
        ${u.loginId !== auth?.userId ? `<button class="btn btn-danger-outline btn-sm" onclick="deleteUser(${i})" title="å‰Šé™¤">ğŸ—‘ï¸</button>` : '<span style="font-size:12px;color:var(--gray-400);padding:0 6px;">ï¼ˆè‡ªåˆ†ï¼‰</span>'}
      </td>
    </tr>`).join('');
  }

  async function addUser() {
    const loginId  = document.getElementById('newUserId').value.trim();
    const name     = document.getElementById('newUserName').value.trim();
    const password = document.getElementById('newUserPassword').value;
    const role     = document.getElementById('newUserRole').value;
    if (!loginId || !name || !password) { showToast('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
    if (users.find(u => u.loginId === loginId)) { showToast('ãã®IDã¯ã™ã§ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™', 'error'); return; }
    if (password.length < 4) { showToast('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„', 'error'); return; }
    const hashed = await hashPassword(password);
    users.push({ loginId, name, password: hashed, role });
    saveUsers(); renderUsers();
    document.getElementById('newUserId').value = '';
    document.getElementById('newUserName').value = '';
    document.getElementById('newUserPassword').value = '';
    showToast(`${name} ã‚’è¿½åŠ ã—ã¾ã—ãŸ`, 'success');
  }

  async function changePassword(idx) {
    const newPass = prompt(`ã€Œ${users[idx].name}ã€ã®æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„`);
    if (newPass === null) return;
    if (!newPass.trim() || newPass.length < 4) { showToast('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„', 'error'); return; }
    users[idx].password = await hashPassword(newPass);
    saveUsers();
    showToast('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ', 'success');
  }

  function deleteUser(idx) {
    if (!confirm(`ã€Œ${users[idx].name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
    users.splice(idx, 1);
    saveUsers(); renderUsers();
    showToast('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async function exportData() {
    const url = localStorage.getItem('gasApiUrl');
    if (!url) { showToast('GAS URLãŒæœªè¨­å®šã§ã™', 'error'); return; }
    showLoading(true);
    try {
      const res = await fetch(`${url}?action=getCustomers`);
      const data = await res.json();
      if (data.error) throw new Error(data.error);
      const customers = data.customers || [];
      if (customers.length === 0) { showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error'); return; }

      const headers = ['ID', 'æ¥­å‹™ID', 'ä¼šç¤¾å', 'æ‹…å½“è€…', 'éƒ¨ç½²', 'é›»è©±ç•ªå·', 'ãƒ¡ãƒ¼ãƒ«', 'ä½æ‰€', 'ã‚¿ã‚°', 'æ¶é›»å›æ•°', 'æœ€çµ‚æ¶é›»æ—¥', 'å‚™è€ƒ', 'ç™»éŒ²æ—¥', 'æ›´æ–°æ—¥'];
      const rows = customers.map(c => [c.id, c.businessId, c.companyName, c.contactName, c.department, c.phone, c.email, c.address, c.tags, c.callCount, c.lastCallDate, c.notes, c.createdAt, c.updatedAt]);
      const bom = '\uFEFF';
      const csv = bom + [headers, ...rows].map(r => r.map(v => `"${String(v || '').replace(/"/g, '""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = `é¡§å®¢ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().slice(0,10)}.csv`;
      a.click(); URL.revokeObjectURL(a.href);
      showToast('CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
    } catch (e) { showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message, 'error'); }
    finally { showLoading(false); }
  }

  function clearLocalData() {
    if (!confirm('ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚')) return;
    localStorage.removeItem('gasApiUrl');
    localStorage.removeItem('operatorName');
    localStorage.removeItem('businesses');
    localStorage.removeItem('operators');
    localStorage.removeItem('callResultTags');
    localStorage.removeItem('callResultTagsByBusiness');
    localStorage.removeItem('customerTagsByBusiness');
    localStorage.removeItem('lastOperatorId');
    document.getElementById('gasUrl').value = '';
    setStatus('unknown', 'â³ æœªãƒ†ã‚¹ãƒˆ');
    operators = []; customTags = [...DEFAULT_TAGS]; selectedTagBizId = '';
    renderOperators(); populateBizSelect(); populateTagBizSelect();
    document.getElementById('tagEditor').style.display = 'none';
    document.getElementById('tagPlaceholder').style.display = '';
    showToast('ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function esc(s) { if (!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
  function showLoading(v) { document.getElementById('loading').classList.toggle('show', v); }
  function showToast(msg, type = 'success') {
    const c = document.getElementById('toastContainer'); const t = document.createElement('div'); t.className = `toast ${type}`;
    t.innerHTML = `<span>${type==='success'?'âœ…':'âŒ'}</span> ${esc(msg)}`;
    c.appendChild(t); setTimeout(() => { t.style.opacity = '0'; t.style.transition = 'opacity 0.3s'; setTimeout(() => t.remove(), 300); }, 4000);
  }
</script>

</body>
</html>
